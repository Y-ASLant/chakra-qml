# PyPI 发布指南

## 快速发布流程

### 1. 准备工作

```bash
# 安装构建工具
pip install build twine
```

### 2. 配置 PyPI 凭证

在 `C:\Users\你的用户名\.pypirc` 创建配置文件：

```ini
[pypi]
username = __token__
password = pypi-你的API令牌
```

**获取 API 令牌：**
1. 登录 https://pypi.org
2. 进入 Account settings → API tokens
3. 点击 "Add API token" 创建新令牌
4. 复制令牌（格式：`pypi-AgEIcHlwaS...`）

### 3. 更新版本号

修改两个文件中的版本号：

**`pyproject.toml`：**
```toml
[project]
version = "1.0.1"
```

**`src/components/__init__.py`：**
```python
__version__ = "1.0.1"
```

### 4. 构建包

```bash
# 清理旧构建
if exist dist rmdir /s /q dist
if exist build rmdir /s /q build
if exist chakra_qtquick.egg-info rmdir /s /q chakra_qtquick.egg-info

# 构建
python -m build
```

构建完成后会在 `dist/` 目录生成：
- `chakra_qtquick-1.0.1-py3-none-any.whl`
- `chakra_qtquick-1.0.1.tar.gz`

### 5. 检查包内容

```bash
# 查看 wheel 包内容
python -m zipfile -l dist\chakra_qtquick-1.0.1-py3-none-any.whl

# 确保所有 .qml 文件都包含在内
```

### 6. 上传到 PyPI

```bash
# 上传
python -m twine upload dist/*

# 如果只上传 wheel 文件
python -m twine upload dist\*.whl
```

### 7. 验证发布

```bash
# 等待 1-2 分钟后安装测试
pip install --upgrade chakra-qtquick

# 测试导入
python -c "import chakra_ui; print(chakra_ui.__version__)"
```

### 8. 创建 Git 标签

```bash
git add .
git commit -m "发布 v1.0.1"
git tag v1.0.1
git push origin main
git push origin v1.0.1
```

## 包信息

- **PyPI 名称：** `chakra-qtquick`
- **Python 包名：** `chakra_ui`
- **安装命令：** `pip install chakra-qtquick`
- **导入方式：** `import chakra_ui`

## 常见问题

### 403 Forbidden 错误

- 检查 `.pypirc` 文件位置是否在用户主目录
- 检查 API token 是否正确
- 确认 token 有上传权限

### 版本冲突

PyPI 不允许重复版本号，如果版本已存在，需要：
1. 修改版本号（如 1.0.0 → 1.0.1）
2. 重新构建
3. 再次上传

### 文件缺失

如果发现 QML 文件没打包进去，检查：
- `pyproject.toml` 中的 `[tool.setuptools.package-data]`
- 确保 `chakra_ui = ["*.qml", "qmldir", "fonts/*.ttf"]` 配置正确

## 完整发布脚本

创建 `publish.bat`：

```batch
@echo off
echo 清理旧构建...
if exist dist rmdir /s /q dist
if exist build rmdir /s /q build
if exist chakra_qtquick.egg-info rmdir /s /q chakra_qtquick.egg-info

echo 构建包...
python -m build

echo 检查包内容...
python -m zipfile -l dist\chakra_qtquick-*.whl

echo.
echo 准备上传，按任意键继续...
pause

echo 上传到 PyPI...
python -m twine upload dist/*

echo.
echo 发布完成！
echo 查看：https://pypi.org/project/chakra-qtquick/
pause
```

使用方法：
```bash
# 1. 更新版本号
# 2. 运行脚本
publish.bat
```

## 相关链接

- **PyPI 项目页：** https://pypi.org/project/chakra-qtquick/
- **文档：** README.md
- **问题反馈：** https://github.com/Y-ASLant/chakra-qml/issues
